<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öæ Softbol Control</title>
  </head>
  <body>
    <!-- LOGIN -->
    <div id="login" class="login-box">
      <h1>‚öæLos atl√©ticos‚öæ</h1>
      <h2>Iniciar sesi√≥n</h2>

      <input type="text" id="usuario" placeholder="Usuario" />
      <input type="password" id="password" placeholder="Contrase√±a" />

      <button onclick="iniciarSesion()">Entrar</button>
      <p id="error-login" class="error"></p>
    </div>

    <!-- MEN√ö -->
    <section id="menu" class="hidden contenedor">
      <h1>Men√∫ Principal</h1>

      <div class="menu-grid">
        <button onclick="mostrar('juegos')">‚öæ Juegos</button>
        <button onclick="mostrar('jugadores')">üë• Jugadores</button>
        <button onclick="mostrar('estadisticas')">üìä Estad√≠sticas</button>
        <button onclick="mostrar('historial')">üìÅ Historial</button>
        <button onclick="resetearTodo()">üßπ Reiniciar sistema</button>
        <button onclick="cerrarSesion()">üö™ Salir</button>
      </div>
    </section>

    <!-- JUEGOS -->
    <section id="juegos" class="hidden contenedor">
      <label style="display:block;margin:10px 0">
  <input type="checkbox" id="pitcherBateaChk" onchange="togglePitcherBatea()">
  El pitcher batea en este juego
</label>
      <h1>‚öæ Juegos & Anotaciones</h1>

      <div class="nuevo-juego">
        <input type="date" id="fechaJuego" />
        <input type="text" id="rivalJuego" placeholder="Equipo rival" />
        <button onclick="crearJuego()">‚ûï Nuevo juego</button>
      </div>
      <div id="marcador" class="hidden">
        <button class="btn-finalizar" onclick="finalizarJuego()">
          üèÅ Finalizar partido
        </button>
        <h2 id="tituloJuego">Juego</h2>

        <!-- ANOTACI√ìN POR JUGADOR -->
        <h3>üß¢ Anotaci√≥n por jugador</h3>
        <div class="tabla-wrapper">
          <table class="tabla-anotacion">
            <thead>
              <tr>
                <th>#</th>
                <th>Jugador</th>
                <th>AB</th>
                <th>H</th>
                <th>HR</th>
                <th>RBI</th>
                <th>BB</th>
                <th>K</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="tablaAnotacion">
              <!-- filas por JS -->
            </tbody>
          </table>
        </div>

<h3>‚öæ Pitchers</h3>
<div class="pitcher-select">
  <label>üéØ Pitcher del juego:</label>

  <select id="selectPitcher">
    <option value="">-- Seleccionar Pitcher --</option>
  </select>

  <button onclick="confirmarPitcher()" class="btn-pitcher">
    ‚ûï Usar este pitcher
  </button>
</div>
<table class="stats-table">
 <thead>
  <tr>
    <th>#</th>
    <th>Nombre</th>
    <th>IP</th>
    <th>H</th>
    <th>ER</th>
    <th>BB</th>
    <th>K</th>
    <th>Decisi√≥n</th> <!-- üëà NUEVA -->
  </tr>
</thead>

  <tbody id="tablaPitchersJuego">
    <!-- AQU√ç ENTRA EL JS -->
  </tbody>
</table>
 <!-- MARCADOR POR INNINGS -->
        <h3>üìä Marcador</h3>
        <table class="scoreboard">
          <thead>
            <tr>
              <th>Equipo</th>
              <th>1</th>
              <th>2</th>
              <th>3</th>
              <th>4</th>
              <th>5</th>
              <th>6</th>
              <th>Total</th>
              <th>H</th>
              <th>E</th>
              <th>R</th>
              <th>LOB</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Los Atleticos</strong></td>
              <td>
                <input
                  type="number"
                  class="me"
                  value="0"
                  oninput="actualizar()"
                />
              </td>
              <td>
                <input
                  type="number"
                  class="me"
                  value="0"
                  oninput="actualizar()"
                />
              </td>
              <td>
                <input
                  type="number"
                  class="me"
                  value="0"
                  oninput="actualizar()"
                />
              </td>
              <td>
                <input
                  type="number"
                  class="me"
                  value="0"
                  oninput="actualizar()"
                />
              </td>
              <td>
                <input
                  type="number"
                  class="me"
                  value="0"
                  oninput="actualizar()"
                />
              </td>
              <td>
                <input
                  type="number"
                  class="me"
                  value="0"
                  oninput="actualizar()"
                />
              </td>
              <td id="totalMe">0</td>
              <td id="hitsMe">0</td>
              <td>
                <input
                  type="number"
                  id="erroresMe"
                  value="0"
                  oninput="actualizarBoxscore()"
                />
              </td>
              <td>
                <input
                  type="number"
                  id="lobMe"
                  value="0"
                  oninput="actualizarBoxscore()"
                />
              </td>
            </tr>
            <tr>
              <td><strong id="nombreRival">Rival</strong></td>
              <td>
                <input
                  type="number"
                  class="rival"
                  value="0"
                  oninput="actualizar()"
                />
              </td>
              <td>
                <input
                  type="number"
                  class="rival"
                  value="0"
                  oninput="actualizar()"
                />
              </td>
              <td>
                <input
                  type="number"
                  class="rival"
                  value="0"
                  oninput="actualizar()"
                />
              </td>
              <td>
                <input
                  type="number"
                  class="rival"
                  value="0"
                  oninput="actualizar()"
                />
              </td>
              <td>
                <input
                  type="number"
                  class="rival"
                  value="0"
                  oninput="actualizar()"
                />
              </td>
              <td>
                <input
                  type="number"
                  class="rival"
                  value="0"
                  oninput="actualizar()"
                />
              </td>
              <td id="totalRival">0</td>
              <td id="hitsRival">0</td>
              <td>
                <input
                  type="number"
                  id="erroresRival"
                  value="0"
                  oninput="actualizarBoxscore()"
                />
              </td>
              <td>
                <input
                  type="number"
                  id="lobRival"
                  value="0"
                  oninput="actualizarBoxscore()"
                />
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <button onclick="mostrar('menu')">‚¨Ö Volver al men√∫</button>
    </section>

    <!-- JUGADORES -->
    <section id="jugadores" class="hidden contenedor">
      <h2>üë• Jugadores</h2>

      <div class="nuevo-jugador">
        <input type="number" id="numJugador" placeholder="#" />
        <input type="text" id="nombreJugador" placeholder="Nombre" />
        <select id="posicionJugador">
          <option>OF</option>
          <option>IF</option>
          <option>P</option>
          <option>C</option>
        </select>
        <button onclick="agregarJugador()">‚ûï Agregar</button>
      </div>

      <table class="tabla-jugadores">
        <thead>
          <tr>
            <th>#</th>
            <th>Nombre</th>
            <th>Pos</th>
            <th>AB</th>
            <th>H</th>
            <th>HR</th>
            <th>RBI</th>
            <th>BB</th>
            <th>K</th>
            <th>AVG</th>
          </tr>
        </thead>
        <tbody id="tablaJugadores"></tbody>
      </table>

      <button onclick="mostrar('menu')">‚¨Ö Volver al men√∫</button>
    </section>

    <!-- ESTAD√çSTICAS -->
    <section id="estadisticas" class="hidden contenedor">
      <h2>üìä Estad√≠sticas</h2>
       <div class="tabla-scroll">
    <table class="stats-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Jugador</th>
            <th>Pos</th>
            <th>AB</th>
            <th>H</th>
            <th>HR</th>
            <th>RBI</th>
            <th>BB</th>
            <th>K</th>
            <th>AVG</th>
          </tr>
        </thead>

        <tbody id="tablaEstadisticas">

        </tbody>
      </table>
      <h3>‚öæ Estad√≠sticas de Pitchers</h3>
<table class="stats-table">
  <thead>
  <tr>
    <th>Pitcher</th>
    <th>G</th>
    <th>P</th>
    <th>IP</th>
    <th>H</th>
    <th>R</th>
    <th>BB</th>
    <th>K</th>
  </tr>
</thead>
<tbody id="tablaPitchersStats"></tbody>
</table>

      <button onclick="mostrar('menu')">‚¨Ö Volver</button>
    </section>

    <section id="historial" class="hidden contenedor">
      <h1>üìö Historial de Juegos</h1>
      <div id="listaHistorial"></div>
      <button onclick="mostrar('menu')">‚¨Ö Volver al men√∫</button>
    </section>
    <style>/* ====== GENERAL ====== */
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0b1fa8;
}

/* UTILIDAD */
.hidden {
  display: none;
}

/* ====== LOGIN ====== */
.login-box {
  background: white;
  width: 360px;
  margin: 80px auto;
  padding: 30px;
  border-radius: 12px;
  text-align: center;
}

.login-box input {
  width: 95%;
  padding: 10px;
  margin: 8px 0;
  font-size: 14px;
}

.login-box button {
  width: 100%;
  padding: 12px;
  margin-top: 12px;
  background: #1e3a8a;
  color: white;
  border: none;
  cursor: pointer;
  font-size: 15px;
}

.error {
  color: red;
  margin-top: 10px;
}

/* ====== CONTENEDOR ====== */
.contenedor {
  background: white;
  max-width: 1000px;
  margin: 40px auto;
  padding: 30px;
  border-radius: 14px;
}

/* ====== MEN√ö ====== */
.menu-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 15px;
  margin-top: 20px;
}

.menu-grid button {
  padding: 16px;
  font-size: 16px;
  cursor: pointer;
}

/* ====== JUEGOS ====== */
.nuevo-juego input {
  padding: 8px;
  margin-right: 6px;
}

.nuevo-juego button {
  padding: 8px 16px;
}

.volver {
  margin-top: 20px;
}

/* ====== MARCADOR ====== */
/* CONTENEDOR DEL MARCADOR */
.scoreboard {
  border-collapse: separate;
  border-spacing: 0;
  border-radius: 14px;
  overflow: hidden;
  background: #ffffff;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  margin-top: 12px;
}

/* CABECERA */
.scoreboard thead {
  background: linear-gradient(135deg, #1e3a8a, #2563eb);
  color: #fff;
}

/* CONTENEDOR DEL MARCADOR */
/* ===== MARCADOR GRANDE ===== */
.scoreboard {
  border-collapse: separate;
  border-spacing: 0;
  border-radius: 20px;
  overflow: hidden;
  background: #ffffff;
  box-shadow: 0 10px 24px rgba(0,0,0,0.18);
  margin: 24px auto;
  width: 100%;
  max-width: 980px;        /* üî• MUCHO M√ÅS GRANDE */
}

/* CABECERA */
.scoreboard thead {
  background: linear-gradient(135deg, #1e3a8a, #2563eb);
  color: #fff;
}

.scoreboard th {
  padding: 14px 10px;      /* üî• M√ÅS ALTO */
  font-size: 15px;        /* üî• M√ÅS GRANDE */
  text-align: center;
  font-weight: 600;
}

/* CELDAS */
.scoreboard td {
  padding: 12px 10px;      /* üî• M√ÅS ALTO */
  font-size: 14px;
  text-align: center;
}

/* INPUTS DE CARRERAS */
.scoreboard input {
  width: 56px;             /* üî• M√ÅS ANCHO */
  height: 40px;            /* üî• M√ÅS ALTO */
  font-size: 15px;
  font-weight: bold;
  text-align: center;
  border-radius: 12px;
  border: 2px solid #cbd5e1;
}

/* TOTALES */
#totalMe,
#totalRival {
  font-size: 16px;
  font-weight: bold;
}

/* HOVER */
.scoreboard tbody tr:hover {
  background: #eef2ff;
}

.scoreboard tbody tr:hover {
  background: #f1f5ff;
}

/* ====== TABLA JUGADORES ====== */

.tabla-jugadores th,
.tabla-jugadores td {
  border: 1px solid #ccc;
  padding: 20px;
  text-align: center;
}

.tabla-jugadores th {
  background: #2563eb;
  color: white;
}

.tabla-jugadores input {
  width: 60px;
  text-align: center;
}

/* ====== TABLA ANOTACI√ìN (LA IMPORTANTE) ====== */
.tabla-anotacion {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  table-layout: fixed;
}

.tabla-anotacion th {
  background: #7a0f5c;
  color: white;
  padding: 10px;
  text-align: center;
}

.tabla-anotacion td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: center;
}

.tabla-anotacion td:nth-child(2) {
  text-align: left;
  font-weight: bold;
}

.tabla-anotacion input {
  width: 100%;
  text-align: center;
}

.tabla-anotacion button {
  padding: 4px 6px;
  font-size: 12px;
  margin: 2px;
  cursor: pointer;
}
.tabla-anotacion {
  table-layout: fixed;
}

.tabla-anotacion th,
.tabla-anotacion td {
  text-align: center;
  vertical-align: middle;
}

.tabla-anotacion td:nth-child(2) {
  text-align: left;
}

.tabla-anotacion input {
  width: 100%;
  box-sizing: border-box;
}
/* =========================
   TABLA ANOTACI√ìN JUGADORES
========================= */

.tabla-anotacion {
  width: 100%;
  border-collapse: collapse;
  font-size: 12px;              /* üîΩ texto peque√±o */
  background: #fff;
}

.tabla-anotacion th,
.tabla-anotacion td {
  padding: 4px 6px;             /* üîΩ menos altura */
  text-align: center;
  border: 1px solid #ddd;
}

.tabla-anotacion th {
  background: #1f2933;
  color: #fff;
  font-weight: 600;
}

/* Nombres alineados */
.tabla-anotacion td:nth-child(2) {
  text-align: left;
  white-space: nowrap;
}

/* Botones peque√±os */
.tabla-anotacion button {
  font-size: 10px;
  padding: 2px 5px;
  margin: 1px;
  border-radius: 4px;
  border: none;
  background: #2563eb;
  color: white;
  cursor: pointer;
}

.tabla-anotacion button:hover {
  background: #1e40af;
}

/* Contenedor con altura fija */
.tabla-anotacion tbody {
  display: block;
  max-height: 320px;            /* ‚úÖ Caben 11 jugadores */
  overflow-y: auto;
}

.tabla-anotacion thead,
.tabla-anotacion tbody tr {
  display: table;
  width: 100%;
  table-layout: fixed;
}
/* Columna NOMBRE */
.tabla-anotacion td:nth-child(2) {
  max-width: 120px;       /* üîí ancho fijo */
  white-space: nowrap;    /* no baja l√≠nea */
  overflow: hidden;       /* corta exceso */
  text-overflow: ellipsis;/* ... */
  text-align: left;
}
/* CONTENEDOR GENERAL DE LA TABLA */
.tabla-anotacion {
  border-collapse: separate;
  border-spacing: 0;
  border-radius: 14px;          /* üîµ CURVAS */
  overflow: hidden;             /* üîí corta esquinas */
  background: #ffffff;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}
.tabla-anotacion thead th:first-child {
  border-top-left-radius: 14px;
}

.tabla-anotacion thead th:last-child {
  border-top-right-radius: 14px;
}
tabla-anotacion tbody tr:last-child td:first-child {
  border-bottom-left-radius: 14px;
}

.tabla-anotacion tbody tr:last-child td:last-child {
  border-bottom-right-radius: 14px;
}
.tabla-anotacion thead {
  background: linear-gradient(135deg, #1e3a8a, #2563eb);
  color: white;
}

.tabla-anotacion tbody tr:nth-child(even) {
  background: #f8fafc;
}

.tabla-anotacion tbody tr:hover {
  background: #e0ecff;
}
/* ===== TABLA ANOTACI√ìN (MISMO TAMA√ëO QUE MARCADOR) ===== */
.tabla-anotacion {
  border-collapse: separate;
  border-spacing: 0;
  border-radius: 20px;
  overflow: hidden;
  background: #ffffff;
  box-shadow: 0 10px 24px rgba(0,0,0,0.18);
  margin: 24px auto;
  width: 100%;
  max-width: 980px;       /* üî• MISMO TAMA√ëO */
}

/* CABECERA */
.tabla-anotacion thead {
  background: linear-gradient(135deg, #0f172a, #1e3a8a);
  color: #fff;
}

.tabla-anotacion th {
  padding: 12px 8px;
  font-size: 14px;
  text-align: center;
  font-weight: 600;
}

/* CELDAS */
.tabla-anotacion td {
  padding: 10px 8px;
  font-size: 13px;
  text-align: center;
}

/* INPUTS / BOTONES */
.tabla-anotacion button {
  padding: 4px 8px;
  font-size: 12px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  background: #2563eb;
  color: #fff;
  margin: 2px;
}

.tabla-anotacion button:hover {
  background: #1d4ed8;
}

/* NOMBRE NO SE SALE */
.tabla-anotacion td:nth-child(2) {
  max-width: 160px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* HOVER */
.tabla-anotacion tbody tr:hover {
  background: #eef2ff;
}
/* ===== TABLA DE ANOTACI√ìN (GRANDE) ===== */
.tabla-anotacion {
  width: 100%;
  max-width: 1150px;     /* ‚¨Ö M√ÅS GRANDE */
  margin: 30px auto;
  border-collapse: separate;
  border-spacing: 0;
  background: #ffffff;
  border-radius: 22px;
  box-shadow: 0 14px 32px rgba(0,0,0,0.25);
  overflow: hidden;
}

/* CABECERA */
.tabla-anotacion thead {
  background: linear-gradient(135deg, #0f172a, #1e40af);
  color: #ffffff;
}

.tabla-anotacion th {
  padding: 14px 10px;
  font-size: 15px;
  font-weight: 600;
  text-align: center;
}

/* CUERPO */
.tabla-anotacion td {
  padding: 12px 10px;
  font-size: 14px;
  text-align: center;
}

/* NOMBRE DEL JUGADOR (NO SE SALE) */
.tabla-anotacion td:nth-child(2) {
  max-width: 220px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* HOVER */
.tabla-anotacion tbody tr:hover {
  background: #e0e7ff;
}
.tabla-wrapper {
  width: 100%;
  overflow-x: auto;
}
.tabla-anotacion {
  width: 100%;
  min-width: 900px; /* üî• CLAVE para muchas columnas */
  border-collapse: collapse;
  table-layout: fixed;
}

.tabla-anotacion th,
.tabla-anotacion td {
  border: 1px solid #ccc;
  padding: 6px;
  text-align: center;
  font-size: 13px;
  white-space: nowrap;
}

.tabla-anotacion th,
.tabla-anotacion td {
  border: 1px solid #ccc;
  padding: 6px;
  text-align: center;
  font-size: 13px;
  white-space: nowrap;
}
.tabla-anotacion button {
  padding: 4px 6px;
  font-size: 11px;
  margin: 2px;
  border-radius: 4px;
  cursor: pointer;
}
.marcador-wrapper {
  width: 100%;
  overflow-x: auto;
}

.tabla-estadisticas th,
.tabla-estadisticas td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: center;
}

.tabla-estadisticas th {
  background-color: #2563eb;
  color: white;
}
/* ===== TABLA ESTAD√çSTICAS ===== */
.tabla-estadisticas {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
  background: #1a0e0e;
}

.tabla-estadisticas th,
.tabla-estadisticas td {
  border: 2px solid #69dd49;
  padding: 8px;
  text-align: center;
  color: #000;
  font-weight: 500;
}

.tabla-estadisticas th {
  background: #0033cc;
  color: #ffffff;
}

.tabla-estadisticas tr:nth-child(even) {
  background: #f2f6ff;
}

.tabla-estadisticas tr:hover {
  background: #dbe6ff;
}
  .tabla-estadisticas {
  border: 5px solid red !important;
}

  .stats-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

.stats-table th,
.stats-table td {
  border: 1px solid #000;
  padding: 8px;
  text-align: center;
}

.stats-table th {
  background-color: #0d2cbf;
  color: white;
}
/* ===== TABLA ESTAD√çSTICAS ===== */
.stats-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  background: #ffffff;
}

.stats-table th,
.stats-table td {
  border: 2px solid #1e40af;
  padding: 8px;
  text-align: center;
  color: #000;
}

.stats-table th {
  background: #1e3a8a;
  color: white;
}

.stats-table tr:nth-child(even) {
  background: #f2f6ff;
}

.stats-table tr:hover {
  background: #dbe6ff;
}

pitcher-box {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

.pitcher-box th,
pitcher-box td {
  border: 1px solid #000;
  padding: 8px;
  text-align: center;
}

.pitcher-box th {
  background-color: #0d2cbf;
  color: white;
}
.tablaPitchers {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  background: #ffffff;
}

.tablaPitchers th,
.tablaPitchers td {
  border: 2px solid #1e40af;
  padding: 8px;
  text-align: center;
  color: #000;
}

.tablaPitchers th {
  background: #2563eb;
  color: white;
}

.tablaPitchers tr:nth-child(even) {
  background: #f2f6ff;
}

.tablaPitchers tr:hover {
  background: #dbe6ff;
}</style>

    <script>console.log("Softbol Control cargado");

let juegos = JSON.parse(localStorage.getItem("juegos")) || [];
let jugadores = JSON.parse(localStorage.getItem("jugadores")) || [];
let juegoActual = null;

/* =====================
   NAVEGACI√ìN
===================== */
function mostrar(id) {
  document.querySelectorAll("section").forEach(sec =>
    sec.classList.add("hidden")
  );

  const seccion = document.getElementById(id);
  if (!seccion) return;

  seccion.classList.remove("hidden");

  if (id === "historial") renderizarHistorial();
  if (id === "jugadores") renderizarJugadores();

  if (id === "estadisticas") {
    renderizarEstadisticas();
    renderizarEstadisticasPitchers();
  }

  // üëá ESTO ES CLAVE
  if (id === "juegos") {
    renderizarPitchers();
  cargarSelectPitchers();
  }
}

/* =====================
   LOGIN
===================== */
function iniciarSesion() {
  document.getElementById("login").style.display = "none";
  mostrar("menu");
}

function cerrarSesion() {
  location.reload();
}

/* =====================
   JUEGOS
===================== */
function crearJuego() {
  const fecha = document.getElementById("fechaJuego").value;
  const rival = document.getElementById("rivalJuego").value;

  if (!fecha || !rival) {
    alert("Completa fecha y rival");
    return;
  }

  if (jugadores.length === 0) {
    alert("Debes agregar jugadores primero");
    return;
  }

  juegoActual = {
    id: Date.now(),
    fecha,
    rival,
    pitcherBatea: false,
    carrerasMe: Array(6).fill(0),
    carrerasRival: Array(6).fill(0),
    erroresMe: 0,
    erroresRival: 0,
    lobMe: 0,
    lobRival: 0,

    anotaciones: jugadores.map(j => ({
  num: j.num,
  nombre: j.nombre,
  pos: j.pos,
  AB: 0,
  H: 0,
  HR: 0,
  RBI: 0,
  BB: 0,
  K: 0,
  IP: 0,
  R: 0
})),
pitchers: [],
    estado: "en_juego"

  }
  
  juegos.push(juegoActual);
  localStorage.setItem("juegos", JSON.stringify(juegos));

  document.getElementById("tituloJuego").textContent =
    `${fecha} vs ${rival}`;

  document.getElementById("nombreRival").textContent = rival;
  document.getElementById("marcador").classList.remove("hidden");

  cargarAnotacionJuego();
  actualizar();
}

function renderizarHistorial() {
  const cont = document.getElementById("listaHistorial");
  cont.innerHTML = "";

  if (juegos.length === 0) {
    cont.innerHTML = "<p>No hay juegos registrados</p>";
    return;
  }

  juegos.forEach(j => {
    const totalMe = j.carrerasMe.reduce((a,b)=>a+b,0);
    const totalRival = j.carrerasRival.reduce((a,b)=>a+b,0);

    const div = document.createElement("div");
    div.className = "juego-item";

    div.innerHTML = `
      <strong>${j.fecha} vs ${j.rival}</strong><br>
      Resultado: ${totalMe} - ${totalRival}<br>
      <button onclick="abrirJuego(${j.id}); mostrar('juegos')">
        üìò Ver / Editar
      </button>
    `;

    cont.appendChild(div);
  });
}


function abrirJuego(id) {
  const juego = juegos.find(j => j.id === id);
  if (!juego) return;

  juegoActual = juego;

  document.getElementById("tituloJuego").textContent =
    `${juegoActual.fecha} vs ${juegoActual.rival}`;

  document.getElementById("nombreRival").textContent =
    juegoActual.rival;

  document.getElementById("marcador").classList.remove("hidden");

  cargarAnotacionJuego(); // ‚úÖ
  actualizar();
  sincronizarJugadoresConJuego();
  renderizarJugadores();
  renderizarEstadisticasPitchers();
}
/* =====================
   ANOTACI√ìN POR JUGADOR
===================== */
function cargarAnotacionJuego() {
  const tabla = document.getElementById("tablaAnotacion");
  tabla.innerHTML = "";

  if (!juegoActual || !Array.isArray(juegoActual.anotaciones)) {
    return;
  }

  juegoActual.anotaciones.forEach((j, i) => {
    tabla.innerHTML += `
      <tr>
          <td>${j.num}</td>
  <td>${j.nombre}</td>
  <td>${j.AB}</td>
  <td>${j.H}</td>
  <td>${j.HR}</td>
  <td>${j.RBI}</td>
  <td>${j.BB}</td>
  <td>${j.K}</td>
  <td>
    <button onclick="sumar(${i}, 'AB')">+AB</button>
    <button onclick="sumar(${i}, 'H')">+H</button>
    <button onclick="sumar(${i}, 'HR')">+HR</button>
    <button onclick="sumar(${i}, 'RBI')">+RBI</button>
    <button onclick="sumar(${i}, 'K')">+K</button>
    <button onclick="sumar(${i}, 'BB')">+BB</button>
  </td>
      </tr>
    `;
  });
}

function sumar(i, campo) {
  const jugador = juegoActual.anotaciones[i];

  // üö´ Pitcher no batea
 if (
  jugador.pos === "P" &&
  !juegoActual.pitcherBatea &&
  ["AB","H","HR","RBI"].includes(campo)
) {
  return alert("Este juego el pitcher NO batea");
}

  jugador[campo]++;
  localStorage.setItem("juegos", JSON.stringify(juegos));

  if (campo === "H" || campo === "HR" || campo === "K") {
    jugador.AB++;
  }

  cargarAnotacionJuego();
  calcularHitsEquipo();
}
function actualizarBoxscore() {
  if (!juegoActual) return;

  juegoActual.erroresMe = Number(document.getElementById("erroresMe").value) || 0;
  juegoActual.erroresRival = Number(document.getElementById("erroresRival").value) || 0;
  juegoActual.lobMe = Number(document.getElementById("lobMe").value) || 0;
  juegoActual.lobRival = Number(document.getElementById("lobRival").value) || 0;

  calcularHitsEquipo();

  const index = juegos.findIndex(j => j.id === juegoActual.id);
  if (index !== -1) juegos[index] = juegoActual;

  localStorage.setItem("juegos", JSON.stringify(juegos));
}
function actualizar() {
  if (typeof juegoActual !== "object" || !juegoActual) return;
  if (!Array.isArray(juegos)) return;

  const meInputs = document.querySelectorAll(".me");
  const rivalInputs = document.querySelectorAll(".rival");

  // Si el marcador a√∫n no est√° en pantalla, salir
  if (meInputs.length === 0 || rivalInputs.length === 0) return;

  let totalMe = 0;
  let totalRival = 0;

  if (!Array.isArray(juegoActual.carrerasMe)) {
    juegoActual.carrerasMe = Array(6).fill(0);
  }
  if (!Array.isArray(juegoActual.carrerasRival)) {
    juegoActual.carrerasRival = Array(6).fill(0);
  }

  meInputs.forEach((input, i) => {
    const val = Number(input.value) || 0;
    juegoActual.carrerasMe[i] = val;
    totalMe += val;
  });

  rivalInputs.forEach((input, i) => {
    const val = Number(input.value) || 0;
    juegoActual.carrerasRival[i] = val;
    totalRival += val;
  });

  const totalMeEl = document.getElementById("totalMe");
  const totalRivalEl = document.getElementById("totalRival");

  if (totalMeEl) totalMeEl.textContent = totalMe;
  if (totalRivalEl) totalRivalEl.textContent = totalRival;

  const index = juegos.findIndex(j => j && j.id === juegoActual.id);
  if (index !== -1) {
    juegos[index] = juegoActual;
    localStorage.setItem("juegos", JSON.stringify(juegos));
  }
}
/* =====================
   JUGADORES
===================== */
function agregarJugador() {
  const num = document.getElementById("numJugador").value.trim();
  const nombre = document.getElementById("nombreJugador").value.trim();
  const pos = document.getElementById("posicionJugador").value;

  if (!num || !nombre) return;

  jugadores.push({ num, nombre, pos });
  renderizarPitchers();
  localStorage.setItem("jugadores", JSON.stringify(jugadores));

  document.getElementById("numJugador").value = "";
  document.getElementById("nombreJugador").value = "";
  document.getElementById("posicionJugador").value = "OF";

  // üîí PROTECCI√ìN
  if (typeof renderizarJugadores === "function") {
    renderizarJugadores();
    sincronizarJugadoresConJuego();
    cargarAnotacionJuego();
    renderizarPitchers();

       // ‚úÖ SOLO SI ES PITCHER
  if (pos === "P") {
    cargarSelectPitchers();
  }

  } else {
    console.warn("renderizarJugadores no est√° definida");
  }
  console.log("Entrando a renderizarJugadores");
  
}
function renderizarJugadores() {
  const tabla = document.getElementById("tablaJugadores");
  if (!tabla) return;

  tabla.innerHTML = "";

  const lista = jugadores.filter(j => j.pos !== "P");

  if (lista.length === 0) {
    tabla.innerHTML = `
      <tr>
        <td colspan="10" style="text-align:center;">
          No hay jugadores registrados
        </td>
      </tr>
    `;
    return;
  }

  lista.forEach(j => {
    tabla.innerHTML += `
      <tr>
        <td>${j.num}</td>
        <td>${j.nombre}</td>
        <td>${j.pos}</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0.000</td>
      </tr>
    `;
  });
}

function calcularEstadisticasEquipo() {
  const stats = {};

  juegos.forEach(juego => {
    if (!juego || juego.estado !== "finalizado") return;
    if (!Array.isArray(juego.anotaciones)) return;

    juego.anotaciones.forEach(a => {
      if (!a || !a.num) return;

      if (!stats[a.num]) {
        stats[a.num] = {
          num: a.num,
          nombre: a.nombre,
          pos: a.pos || "-",
          AB: 0,
          H: 0,
          HR: 0,
          RBI: 0,
          BB: 0,
          K: 0
        };
      }

      stats[a.num].AB  += Number(a.AB)  || 0;
      stats[a.num].H   += Number(a.H)   || 0;
      stats[a.num].HR  += Number(a.HR)  || 0;
      stats[a.num].RBI += Number(a.RBI) || 0;
      stats[a.num].BB  += Number(a.BB)  || 0;
      stats[a.num].K   += Number(a.K)   || 0;
    });
  });

  return Object.values(stats);
}
function calcularHitsEquipo() {
  let hitsMe = 0;
  let hitsRival = 0;

  juegoActual.anotaciones.forEach(j => {
    hitsMe += j.H;
  });

  document.getElementById("hitsMe").textContent = hitsMe;
  document.getElementById("hitsRival").textContent = hitsRival;
}
function sincronizarJugadoresConJuego() {
  if (!juegoActual) return;

  jugadores.forEach(j => {
    const existe = juegoActual.anotaciones.find(a => a.num === j.num);
    if (!existe) {
      juegoActual.anotaciones.push({
        num: j.num,
        nombre: j.nombre,
        pos: j.pos,
        AB: 0,
        H: 0,
        HR: 0,
        RBI: 0,
        BB: 0,
        K: 0
      });
    }
  });

  const index = juegos.findIndex(j => j.id === juegoActual.id);
  if (index !== -1) juegos[index] = juegoActual;

  localStorage.setItem("juegos", JSON.stringify(juegos));
  
}
function finalizarJuego() {
  if (!juegoActual) return;

  juegoActual.estado = "finalizado";

  if (!Array.isArray(juegoActual.pitchers)) {
    juegoActual.pitchers = [];
  }

  const i = juegos.findIndex(j => j.id === juegoActual.id);
  if (i !== -1) {
    juegos[i] = juegoActual;
  } else {
    juegos.push(juegoActual);
  }

  localStorage.setItem("juegos", JSON.stringify(juegos));

  renderizarEstadisticasPitchers();

  alert("Juego finalizado ‚úÖ");
  juegoActual = null;
  mostrar("menu");
}

function renderizarEstadisticasPitchers() {

  const tbody = document.getElementById("tablaPitchersStats");
  if (!tbody) return;

  tbody.innerHTML = "";

  const stats = {};

  juegos
    .filter(j => j.estado === "finalizado" && j.pitchers?.length)
    .forEach(juego => {

      if (!juego.pitchers || !Array.isArray(juego.pitchers)) return;

      juego.pitchers.forEach(p => {

  if (!p.nombre) return;

        if (!stats[p.nombre]) {
          stats[p.nombre] = {
            nombre: p.nombre,
            G: 0,
            P: 0,
            IP: 0,
            H: 0,
            R: 0,
            BB: 0,
            K: 0
          };
        }

        if (p.decision === "G") stats[p.nombre].G++;
        if (p.decision === "P") stats[p.nombre].P++;

        stats[p.nombre].IP += Number(p.IP) || 0;
        stats[p.nombre].H  += Number(p.H)  || 0;
        stats[p.nombre].R  += Number(p.R)  || 0;
        stats[p.nombre].BB += Number(p.BB) || 0;
        stats[p.nombre].K  += Number(p.K)  || 0;

      });
    });

  Object.values(stats).forEach(p => {

    const ERA = p.IP > 0 
      ? ((p.R * 9) / p.IP).toFixed(2)
      : "0.00";

    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${p.nombre}</td>
      <td>${p.G}</td>
      <td>${p.P}</td>
      <td>${p.IP}</td>
      <td>${p.H}</td>
      <td>${p.R}</td>
      <td>${p.BB}</td>
      <td>${p.K}</td>
    `;

    tbody.appendChild(tr);
  });

}


function cargarEstadisticas(jugadores) {
  const tbody = document.getElementById("9");
  tbody.innerHTML = "";

  jugadores.forEach((j, i) => {
    const avg = j.ab > 0 ? (j.h / j.ab).toFixed(3) : ".000";

    tbody.innerHTML += `
      <tr>
        <td>${i + 1}</td>
        <td>${j.nombre}</td>
        <td>${j.pos}</td>
        <td>${j.ab}</td>
        <td>${j.h}</td>
        <td>${j.hr}</td>
        <td>${j.rbi}</td>
        <td>${j.bb}</td>
        <td>${j.k}</td>
        <td>${avg}</td>
      </tr>
    `;
  });
  mostrar("estadisticas");

}
function renderizarEstadisticas() {
  const tabla = document.getElementById("tablaEstadisticas");
  if (!tabla) return;

  tabla.innerHTML = "";

  const datos = calcularEstadisticasEquipo();

  if (datos.length === 0) {
    tabla.innerHTML = `
      <tr>
        <td colspan="10" style="text-align:center">
          No hay estad√≠sticas registradas
        </td>
      </tr>`;
    return;
  }

  datos.forEach((j, i) => {
    const AB = j.AB || 0;
    const H  = j.H  || 0;
    const avg = AB > 0 ? (H / AB).toFixed(3) : "0.000";

    tabla.innerHTML += `
      <tr>
        <td>${i + 1}</td>
        <td>${j.nombre}</td>
        <td>${j.pos}</td>
        <td>${AB}</td>
        <td>${H}</td>
        <td>${j.HR}</td>
        <td>${j.RBI}</td>
        <td>${j.BB}</td>
        <td>${j.K}</td>
        <td>${avg}</td>
      </tr>
    `;
  });
}
function renderizarPitchers() {
  const tbody = document.getElementById("tablaPitchersJuego");
  if (!tbody || !juegoActual) return;

  tbody.innerHTML = "";

  if (!Array.isArray(juegoActual.pitchers) || juegoActual.pitchers.length === 0) {
    tbody.innerHTML = `
      <tr>
        <td colspan="8" style="text-align:center">
          No hay pitcher asignado
        </td>
      </tr>`;
    return;
  }

  juegoActual.pitchers.forEach((p, i) => {
    tbody.innerHTML += `
      <tr>
        <td>${p.num}</td>
        <td>${p.nombre}</td>

        <td><button onclick="sumarPitcher(${i},'IP')">+</button> ${p.IP}</td>
        <td><button onclick="sumarPitcher(${i},'H')">+</button> ${p.H}</td>
        <td><button onclick="sumarPitcher(${i},'R')">+</button> ${p.R}</td>
        <td><button onclick="sumarPitcher(${i},'BB')">+</button> ${p.BB}</td>
        <td><button onclick="sumarPitcher(${i},'K')">+</button> ${p.K}</td>

        <td>
          <button onclick="setDecision(${i},'G')" ${p.decision==='G'?'style="background:#4caf50;color:#fff"':''}>G</button>
          <button onclick="setDecision(${i},'P')" ${p.decision==='P'?'style="background:#f44336;color:#fff"':''}>P</button>
        </td>
      </tr>
    `;
  });
}
function sumarPitcher(index, campo) {
  if (!juegoActual || !juegoActual.pitchers[index]) return;

  juegoActual.pitchers[index][campo] =
    Number(juegoActual.pitchers[index][campo] || 0) + 1;

  // GUARDAR DENTRO DEL JUEGO
  const i = juegos.findIndex(j => j.id === juegoActual.id);
  if (i !== -1) juegos[i] = juegoActual;

  localStorage.setItem("juegos", JSON.stringify(juegos));
  renderizarPitchers();
}

function togglePitcherBatea() {
  if (!juegoActual) return;

  juegoActual.pitcherBatea =
    document.getElementById("pitcherBateaChk").checked;

  localStorage.setItem("juegos", JSON.stringify(juegos));

}
let pitcherActual = null;

function cargarSelectPitchers() {
  const select = document.getElementById("selectPitcher");
  if (!select) return;

  select.innerHTML = '<option value="">-- Seleccionar Pitcher --</option>';

  jugadores
    .filter(j => j.pos === "P")
    .forEach(p => {
      select.innerHTML += `
        <option value="${p.num}">
          ${p.num} - ${p.nombre}
        </option>
      `;
    });
}
function asignarPitcher() {
  const select = document.getElementById("selectPitcher");
  const pitcherNum = select.value;

  if (!pitcherNum || !juegoActual) return;

  const jugador = jugadores.find(j => j.num == pitcherNum);
  if (!jugador) return;

  // Evitar duplicados
  const existe = juegoActual.pitchers.some(p => p.num == jugador.num);
  if (existe) {
    alert("Este pitcher ya est√° agregado");
    return;
  }

  juegoActual.pitchers.push({
    num: jugador.num,
    nombre: jugador.nombre,
    IP: 0,
    H: 0,
    R: 0,
    BB: 0,
    K: 0,
    decision: null
  });

  localStorage.setItem("juegos", JSON.stringify(juegos));
  renderizarPitchers();
}
function confirmarPitcher() {
  if (!juegoActual) return;

  const select = document.getElementById("selectPitcher");
  if (!select) return;

  const num = select.value;
  if (!num) {
    alert("Selecciona un pitcher");
    return;
  }

  // asegurar array
  if (!Array.isArray(juegoActual.pitchers)) {
    juegoActual.pitchers = [];
  }

  // evitar duplicados
  if (juegoActual.pitchers.some(p => String(p.num) === String(num))) {
    alert("Este pitcher ya est√° agregado");
    return;
  }

  const jugador = jugadores.find(j => String(j.num) === String(num));
  if (!jugador) {
    alert("Pitcher no encontrado");
    return;
  }

  juegoActual.pitchers.push({
    num: jugador.num,
    nombre: jugador.nombre,
    IP: 0,
    H: 0,
    R: 0,
    BB: 0,
    K: 0,
    decision: null
  });

  // guardar correctamente
  const index = juegos.findIndex(j => j.id === juegoActual.id);
  if (index !== -1) juegos[index] = juegoActual;

  localStorage.setItem("juegos", JSON.stringify(juegos));

  // limpiar select
  select.value = "";

  renderizarPitchers();
}
function agregarPitcherATabla(pitcher) {
  const tbody = document.getElementById("tablaPitchersJuego");

  // Evitar duplicados
  if ([...tbody.rows].some(f => f.dataset.id == pitcher.id)) {
    alert("Este pitcher ya est√° agregado");
    return;
  }

  const fila = document.createElement("tr");
  fila.dataset.id = pitcher.id;

  fila.innerHTML = `
    <td>${tbody.rows.length + 1}</td>
    <td>${pitcher.nombre}</td>
    <td>0.0</td>
    <td>0</td>
    <td>0</td>
    <td>0</td>
    <td>0</td>
  `;

  tbody.appendChild(fila);
}
function setDecision(index, tipo) {
  if (!juegoActual || !juegoActual.pitchers[index]) return;

  juegoActual.pitchers.forEach(p => p.decision = null);
  juegoActual.pitchers[index].decision = tipo;

  const i = juegos.findIndex(j => j.id === juegoActual.id);
  if (i !== -1) juegos[i] = juegoActual;

  localStorage.setItem("juegos", JSON.stringify(juegos));
  renderizarPitchers();
}

function resetearTodo() {
  if (!confirm("¬øSeguro que deseas borrar todos los datos?")) return;

  localStorage.removeItem("juegos");
  localStorage.removeItem("jugadores");

  localStorage.clear();
  location.reload();
  console.log("JS cargado correctamente");
}
</script>
  </body>
</html>
